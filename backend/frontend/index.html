<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Insightful Eight Ltd | v6.0</title>
  
    <!-- PWA Meta (for install on phones – no look change) -->
    <meta name="theme-color" content="#020617">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Insightful Eight">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: {
                        brand: { 500: '#6366f1', 600: '#4f46e5', 900: '#312e81' },
                        dark: { 950: '#020617', 900: '#0f172a', 800: '#1e293b' }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.4s ease-out forwards',
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #020617; color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); }
        .modal-glass { background: rgba(2, 6, 23, 0.95); backdrop-filter: blur(10px); }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .nav-item { transition: all 0.2s ease; border-left: 3px solid transparent; }
        .nav-item.active { background: rgba(99, 102, 241, 0.1); color: #818cf8; border-left-color: #6366f1; }
        .welfare-step.active { color: #10b981; font-weight: bold; }
        .welfare-step.pending { color: #64748b; }
    </style>
</head>
<body class="flex h-screen overflow-hidden select-none bg-dark-950 font-sans">
    <!-- Paste your full original demo <body> content here exactly as provided in your message (from <div id="splash-screen"> to </div> before <script>) – no changes to look -->
    <div id="splash-screen" class="fixed inset-0 z-[100] bg-dark-950 flex flex-col items-center justify-center transition-opacity duration-700">
        <div class="w-20 h-20 rounded-2xl bg-gradient-to-tr from-brand-600 to-indigo-400 flex items-center justify-center text-white font-bold text-4xl mb-6 shadow-2xl shadow-brand-500/20">i8</div>
        <p class="text-white text-lg font-bold">Insightful Eight Ltd</p>
        <p class="text-slate-500 text-xs font-bold uppercase tracking-[0.2em] mt-2 animate-pulse">Loading System v6.0</p>
    </div>
    <div id="screen-auth" class="fixed inset-0 z-[60] bg-dark-950 flex flex-col items-center justify-center p-6 transition-all duration-500">
        <div class="w-16 h-16 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-white font-bold text-2xl mb-6">i8</div>
        <h1 class="text-2xl font-bold text-white mb-2">Member Login</h1>
        <p class="text-slate-500 text-sm mb-8">Insightful Eight Ltd</p>
        <div class="w-full max-w-xs">
            <input type="password" id="member-pin" maxlength="4" class="w-full bg-dark-900 border border-white/10 rounded-xl text-center text-2xl tracking-[1em] text-white p-4 outline-none focus:border-brand-500 transition mb-4 placeholder-slate-700" placeholder="••••">
            <button onclick="App.memberLogin()" class="w-full bg-brand-600 text-white font-bold py-3.5 rounded-xl hover:bg-brand-500 transition shadow-lg">Access Portal</button>
            <p class="text-center text-xs text-slate-600 mt-6">Pin: 1234</p>
            <button onclick="App.showRegister()" class="w-full text-slate-500 text-xs mt-2 hover:text-white">New Member? Register Here</button>
        </div>
    </div>
    <div id="screen-register" class="hidden fixed inset-0 z-[60] bg-dark-950 flex flex-col items-center justify-center p-6 transition-all duration-500">
        <div class="w-16 h-16 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-white font-bold text-2xl mb-6">i8</div>
        <h1 class="text-2xl font-bold text-white mb-2">New Member Registration</h1>
        <p class="text-slate-500 text-sm mb-8">Match your details and set PIN</p>
        <div class="w-full max-w-xs space-y-4">
            <input type="text" id="reg-name" placeholder="Full Name" class="w-full bg-dark-900 border border-white/10 rounded-xl p-3 text-white">
            <input type="email" id="reg-email" placeholder="Email" class="w-full bg-dark-900 border border-white/10 rounded-xl p-3 text-white">
            <input type="password" id="reg-pin" maxlength="4" class="w-full bg-dark-900 border border-white/10 rounded-xl text-center text-2xl tracking-[1em] text-white p-3" placeholder="••••">
            <button onclick="App.registerMember()" class="w-full bg-brand-600 text-white font-bold py-3.5 rounded-xl hover:bg-brand-500 transition shadow-lg">Register</button>
            <button onclick="App.showLogin()" class="w-full text-slate-500 text-sm py-2">Back to Login</button>
        </div>
    </div>
    <div id="toast-box" class="fixed top-6 left-1/2 transform -translate-x-1/2 z-[200] flex flex-col gap-3 w-full max-w-sm px-4 pointer-events-none"></div>
    <div id="portal-member" class="hidden flex w-full h-full transition-all duration-500 transform scale-100 opacity-100 origin-center">
        <aside class="hidden md:flex flex-col w-72 bg-dark-950/50 backdrop-blur-xl border-r border-dark-800 z-20">
            <div class="h-24 flex items-center px-8 border-b border-white/5">
                <div class="w-10 h-10 rounded-xl bg-gradient-to-tr from-brand-600 to-indigo-400 flex items-center justify-center text-white font-bold text-xl mr-3 shadow-lg shadow-brand-500/20">i8</div>
                <div><h1 class="font-bold text-lg text-white tracking-tight">Insightful 8</h1><p class="text-[10px] text-slate-500 font-bold uppercase tracking-widest">Portal</p></div>
            </div>
            <nav class="flex-1 px-4 py-6 space-y-1">
                <button onclick="App.nav('dashboard')" id="nav-dashboard" class="nav-item active w-full flex items-center gap-3 px-4 py-3.5 rounded-r-xl text-slate-400 font-medium hover:text-white hover:bg-white/5"><i class="fa-solid fa-grid-2 w-5"></i> Dashboard</button>
                <button onclick="App.nav('finance')" id="nav-finance" class="nav-item w-full flex items-center gap-3 px-4 py-3.5 rounded-r-xl text-slate-400 font-medium hover:text-white hover:bg-white/5"><i class="fa-solid fa-wallet w-5"></i> Finance & Loans</button>
                <button onclick="App.nav('welfare')" id="nav-welfare" class="nav-item w-full flex items-center gap-3 px-4 py-3.5 rounded-r-xl text-slate-400 font-medium hover:text-white hover:bg-white/5"><i class="fa-solid fa-hand-holding-heart w-5"></i> Welfare</button>
                <button onclick="App.nav('vote')" id="nav-vote" class="nav-item w-full flex items-center gap-3 px-4 py-3.5 rounded-r-xl text-slate-400 font-medium hover:text-white hover:bg-white/5"><i class="fa-solid fa-check-to-slot w-5"></i> Elections</button>
                <button onclick="App.nav('profile')" id="nav-profile" class="nav-item w-full flex items-center gap-3 px-4 py-3.5 rounded-r-xl text-slate-400 font-medium hover:text-white hover:bg-white/5"><i class="fa-solid fa-user w-5"></i> Profile</button>
                <div class="mt-auto border-t border-white/5 pt-4">
                    <button onclick="App.switchContext('admin')" class="w-full flex items-center gap-3 px-4 py-3.5 rounded-r-xl text-amber-500 font-medium hover:bg-amber-500/10 border-l-4 border-transparent hover:border-amber-500 transition group"><i class="fa-solid fa-shield-halved w-5 group-hover:scale-110 transition"></i> Executive Admin</button>
                </div>
            </nav>
        </aside>
        <main class="flex-1 flex flex-col relative h-full bg-gradient-to-br from-dark-950 via-dark-900 to-dark-950">
            <header class="md:hidden h-16 flex items-center justify-between px-5 bg-dark-950/80 backdrop-blur border-b border-white/5 sticky top-0 z-30">
                <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-lg bg-brand-600 flex items-center justify-center text-white font-bold">i8</div><span id="header-title" class="font-bold text-lg text-white">Dashboard</span></div>
                <button onclick="App.switchContext('admin')" class="ml-auto text-amber-500 text-xs font-bold uppercase border border-amber-500/30 px-3 py-1.5 rounded-lg active:bg-amber-500/10">Admin</button>
            </header>
            <div id="member-view-container" class="flex-1 overflow-y-auto hide-scroll p-5 pb-32 md:p-10">
                <section id="view-dashboard" class="space-y-8 animate-slide-up max-w-6xl mx-auto">
                    <div class="flex justify-between items-end">
                        <div><h2 class="text-3xl font-bold text-white tracking-tight">Insightful Eight Ltd</h2><p class="text-sm text-slate-400 mt-1">Welcome back, <span id="welcome-user"></span>.</p></div>
                    </div>
                    <button onclick="App.toggleNotifications()" class="absolute top-6 right-6 text-white bg-white/10 p-2 rounded-full hover:bg-white/20"><i class="fa-solid fa-bell"></i><span id="notif-badge" class="hidden absolute -top-1 -right-1 bg-red-500 text-xs rounded-full w-5 h-5 flex items-center justify-center">0</span></button>
                    <div id="notifications-panel" class="hidden glass p-4 rounded-xl absolute top-16 right-6 z-10 space-y-2 w-80">
                        <h4 class="font-bold text-white">Personal Notifications</h4>
                        <div id="notif-list"></div>
                    </div>
                    <div class="glass p-6 rounded-2xl border-l-4 border-l-brand-500">
                        <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-white text-sm flex items-center gap-2"><i class="fa-solid fa-bullhorn text-brand-400"></i> Official Communications</h3><span class="text-[10px] text-slate-500">Verified by Chair</span></div>
                        <div id="member-news-feed" class="space-y-4"></div>
                    </div>
                    <div class="glass p-6 rounded-2xl border-l-4 border-l-emerald-400">
                        <div class="flex justify-between items-center mb-4"><h3 class="font-bold text-white text-sm flex items-center gap-2"><i class="fa-solid fa-chart-line text-emerald-400"></i> Approved Financial Reports</h3><span class="text-[10px] text-slate-500">Chair Verified</span></div>
                        <div id="approved-reports" class="space-y-4"></div>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="glass p-6 rounded-2xl"><p class="text-xs text-slate-400 font-bold uppercase tracking-wider">Company Liquidity</p><h3 class="text-3xl font-bold text-white mt-1">KES 1.2M</h3></div>
                        <div class="glass p-6 rounded-2xl cursor-pointer hover:bg-white/5" onclick="App.nav('vote')"><p class="text-xs text-slate-400 font-bold uppercase tracking-wider">Active Polls</p><h3 id="dash-poll-count" class="text-3xl font-bold text-white mt-1">0</h3></div>
                        <div class="glass p-6 rounded-2xl border-l-4 border-l-emerald-500"><p class="text-xs text-slate-400 font-bold uppercase tracking-wider">My Welfare Status</p><h3 class="text-xl font-bold text-white mt-1">Good Standing</h3></div>
                    </div>
                </section>
                <!-- Paste all other sections (view-finance, view-welfare, view-vote, view-profile, modals) from your original demo exactly – no changes -->
                <!-- ... (rest of demo body) ... -->
            </div>
        </main>
    </div>
    <!-- PWA SW Registration -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js');
        });
      }
    </script>
    <script>
        // Real App Script (demo logic + API calls – fallback to demo data)
        const API_BASE = 'https://your-render-url.onrender.com/api';  // Update with Render URL
        let userToken = localStorage.getItem('token') || '';

        const App = {
            data: { // Fallback demo data for offline
                user: 'Felix',
                role: null,
                news: [],
                polls: [{ id: 1, q: 'End of Year Party Venue?', opts: ['Naivasha', 'Mombasa', 'Eldoret'], votes: [2, 5, 1], voters: [], active: true }],
                approvedReports: [],
                welfare: [],
                chairQueue: [],
                transactions: [{ t: 'Monthly Contribution', d: 'Dec 01', a: 5000, type: 'in' }, { t: 'Welfare Payout #003', d: 'Nov 15', a: 10000, type: 'out' }],
                logs: [],
                members: [{name: 'Felix', email: 'felix@example.com', pin: '1234'}, {name: 'John', email: 'john@example.com', pin: '0000'}],
                signatures: { Secretary: 'Current Secretary', Treasurer: 'Current Treasurer', Chairperson: 'Current Chairperson', SupervisoryCommittee: 'Current Sup. Comm.', CommitteeMember: 'Current Comm. Member' },
                notifications: [],
                loans: []
            },
            // Real async functions (fetch from backend, fallback to data)
            async memberLogin() {
                const pin = document.getElementById('member-pin').value;
                try {
                    const res = await fetch(`${API_BASE}/auth`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ pin })
                    });
                    const data = await res.json();
                    if (data.user) {
                        App.data.user = data.user.name;
                        localStorage.setItem('token', data.token);
                        userToken = data.token;
                        document.getElementById('screen-auth').classList.add('opacity-0', 'pointer-events-none');
                        document.getElementById('portal-member').classList.remove('hidden');
                        document.getElementById('welcome-user').innerText = App.data.user;
                        await App.renderAll();
                        await App.renderNotifications();
                    } else alert('Wrong PIN');
                } catch (err) {
                    // Fallback demo login
                    const demoPin = '1234';
                    if (pin === demoPin) {
                        App.data.user = 'Felix';
                        document.getElementById('screen-auth').classList.add('opacity-0', 'pointer-events-none');
                        document.getElementById('portal-member').classList.remove('hidden');
                        document.getElementById('welcome-user').innerText = App.data.user;
                        App.renderAll();
                        App.renderNotifications();
                    } else alert('Wrong PIN');
                }
            },
            async renderNews() {
                try {
                    const res = await fetch(`${API_BASE}/news`, {
                        headers: { 'Authorization': `Bearer ${userToken}` }
                    });
                    const news = await res.json();
                    const el = document.getElementById('member-news-feed');
                    el.innerHTML = news.length ? '' : '<p class="text-slate-500 text-sm italic">No official news released.</p>';
                    news.forEach(n => {
                        el.innerHTML += `<div class="bg-white/5 p-4 rounded-xl border border-white/5"><p class="text-sm text-white">${n.text}</p><p class="text-[10px] text-slate-500 mt-2 text-right">Signed: ${n.signedBy}</p></div>`;
                    });
                } catch (err) {
                    // Fallback demo
                    const el = document.getElementById('member-news-feed');
                    el.innerHTML = '<p class="text-slate-500 text-sm italic">No official news released.</p>';
                }
            },
            // Similar async for renderApprovedReports, renderFinance, renderWelfareMember, renderPolls, renderNotifications (fetch, map fields, fallback to App.data)
            // Example for renderWelfareMember
            async renderWelfareMember() {
                try {
                    const res = await fetch(`${API_BASE}/welfare?member=${App.data.user}`, {
                        headers: { 'Authorization': `Bearer ${userToken}` }
                    });
                    const welfare = await res.json();
                    const list = document.getElementById('welfare-list');
                    list.innerHTML = welfare.length ? '' : '<p class="text-slate-500 text-sm italic">No claims history.</p>';
                    welfare.forEach(w => {
                        const s1 = w.Status === 'Sec' ? 'text-blue-400 animate-pulse' : 'text-emerald-500';
                        const s2 = w.Status === 'Treas' ? 'text-blue-400 animate-pulse' : (w.Status === 'Chair' || w.Status === 'Paid' ? 'text-emerald-500' : 'text-slate-700');
                        const s3 = w.Status === 'Chair' ? 'text-blue-400 animate-pulse' : (w.Status === 'Paid' ? 'text-emerald-500' : 'text-slate-700');
                        list.innerHTML += `
                            <div class="bg-dark-900 p-4 rounded-xl border border-white/5">
                                <div class="flex justify-between mb-3"><span class="font-bold text-white text-sm">${w.Type}</span><span class="font-mono text-pink-400 text-sm">KES ${w.Amount}</span></div>
                                <div class="flex items-center justify-between text-xs px-2">
                                    <div class="text-center ${s1}"><i class="fa-solid fa-file-pen"></i><p class="scale-75">Recorded</p></div>
                                    <div class="h-0.5 w-8 bg-white/10"></div>
                                    <div class="text-center ${s2}"><i class="fa-solid fa-coins"></i><p class="scale-75">Funded</p></div>
                                    <div class="h-0.5 w-8 bg-white/10"></div>
                                    <div class="text-center ${s3}"><i class="fa-solid fa-stamp"></i><p class="scale-75">Released</p></div>
                                </div>
                                <p class="text-xs text-slate-500 mt-2 text-center">Claimed by: ${w.Member} on ${w.Date}</p>
                            </div>`;
                    });
                } catch (err) {
                    // Fallback demo
                    const list = document.getElementById('welfare-list');
                    list.innerHTML = '<p class="text-slate-500 text-sm italic">No claims history.</p>';
                }
            },
            // Example for submitWelfare (POST to backend)
            async submitWelfare() {
                const type = document.getElementById('welfare-type').value;
                const amt = document.getElementById('welfare-amount').value;
                if(!amt) return;
                try {
                    const res = await fetch(`${API_BASE}/welfare`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${userToken}` },
                        body: JSON.stringify({ type, amount: parseInt(amt), member: App.data.user })
                    });
                    if (res.ok) {
                        document.getElementById('modal-welfare').classList.add('hidden');
                        App.toast('Claim Sent to Secretary for Recording', 'success');
                        await App.renderWelfareMember();
                    } else throw new Error();
                } catch (err) {
                    // Fallback demo submit
                    App.data.welfare.push({ id: Date.now(), type, amount: amt, member: App.data.user, status: 'Sec', date: new Date().toLocaleDateString() });
                    App.toast('Claim Sent to Secretary for Recording', 'success');
                    App.renderWelfareMember();
                }
            },
            // ... (add async fetch to all renders/submits like renderPolls, castVote, chairApprove, createPoll, submitNews, etc. – follow pattern)
            // Your original demo functions (nav, toast, adminLogout, etc.) remain unchanged
            // Paste all your original demo script functions here, with async added where needed
            // ... (rest of original demo script) ...
        };
        window.onload = () => { setTimeout(() => document.getElementById('splash-screen').classList.add('opacity-0', 'pointer-events-none'), 1500); };
    </script>
</body>
</html>
