<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Insightful Eight Ltd | v1.0.1</title>
    <!-- PWA Meta -->
    <meta name="theme-color" content="#020617">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Insightful Eight">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Plus Jakarta Sans', 'sans-serif'] },
                    colors: {
                        brand: { 500: '#6366f1', 600: '#4f46e5', 900: '#312e81' },
                        dark: { 950: '#020617', 900: '#0f172a', 800: '#1e293b' }
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.4s ease-out forwards',
                        'slide-up': 'slideUp 0.3s ease-out forwards',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: '0' }, '100%': { opacity: '1' } },
                        slideUp: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>
    <style>
        body { background-color: #020617; color: #f8fafc; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(16px); -webkit-backdrop-filter: blur(16px); border: 1px solid rgba(255,255,255,0.05); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1); }
        .modal-glass { background: rgba(2, 6, 23, 0.95); backdrop-filter: blur(10px); }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .nav-item { transition: all 0.2s ease; border-left: 3px solid transparent; }
        .nav-item.active { background: rgba(99, 102, 241, 0.1); color: #818cf8; border-left-color: #6366f1; }
        .welfare-step.active { color: #10b981; font-weight: bold; }
        .welfare-step.pending { color: #64748b; }
        .toast { animation: slideUp 0.3s ease-out; }
    </style>
</head>
<body class="flex h-screen overflow-hidden select-none bg-dark-950 font-sans">
    <div id="splash-screen" class="fixed inset-0 z-[100] bg-dark-950 flex flex-col items-center justify-center transition-opacity duration-700">
        <div class="w-20 h-20 rounded-2xl bg-gradient-to-tr from-brand-600 to-indigo-400 flex items-center justify-center text-white font-bold text-4xl mb-6 shadow-2xl shadow-brand-500/20">i8</div>
        <p class="text-white text-lg font-bold">Insightful Eight Ltd</p>
        <p class="text-slate-500 text-xs font-bold uppercase tracking-[0.2em] mt-2 animate-pulse">Loading System v6.0</p>
    </div>
    <div id="screen-auth" class="fixed inset-0 z-[60] bg-dark-950 flex flex-col items-center justify-center p-6 transition-all duration-500">
        <div class="w-16 h-16 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-white font-bold text-2xl mb-6">i8</div>
        <h1 class="text-2xl font-bold text-white mb-2">Member Login</h1>
        <p class="text-slate-500 text-sm mb-8">Insightful Eight Ltd</p>
        <div class="w-full max-w-xs">
            <input type="password" id="member-pin" maxlength="4" class="w-full bg-dark-900 border border-white/10 rounded-xl text-center text-2xl tracking-[1em] text-white p-4 outline-none focus:border-brand-500 transition mb-4 placeholder-slate-700" placeholder="••••">
            <button onclick="App.memberLogin()" class="w-full bg-brand-600 text-white font-bold py-3.5 rounded-xl hover:bg-brand-500 transition shadow-lg">Access Portal</button>
            <p class="text-center text-xs text-slate-600 mt-6">Pin: 1234</p>
            <button onclick="App.showRegister()" class="w-full text-slate-500 text-xs mt-2 hover:text-white">New Member? Register Here</button>
        </div>
    </div>
    <div id="screen-register" class="hidden fixed inset-0 z-[60] bg-dark-950 flex flex-col items-center justify-center p-6 transition-all duration-500">
        <div class="w-16 h-16 rounded-2xl bg-white/5 border border-white/10 flex items-center justify-center text-white font-bold text-2xl mb-6">i8</div>
        <h1 class="text-2xl font-bold text-white mb-2">New Member Registration</h1>
        <p class="text-slate-500 text-sm mb-8">Match your details and set PIN</p>
        <div class="w-full max-w-xs space-y-4">
            <input type="text" id="reg-name" placeholder="Full Name" class="w-full bg-dark-900 border border-white/10 rounded-xl p-3 text-white">
            <input type="email" id="reg-email" placeholder="Email" class="w-full bg-dark-900 border border-white/10 rounded-xl p-3 text-white">
            <input type="password" id="reg-pin" maxlength="4" class="w-full bg-dark-900 border border-white/10 rounded-xl text-center text-2xl tracking-[1em] text-white p-3" placeholder="••••">
            <button onclick="App.registerMember()" class="w-full bg-brand-600 text-white font-bold py-3.5 rounded-xl hover:bg-brand-500 transition shadow-lg">Register</button>
            <button onclick="App.showLogin()" class="w-full text-slate-500 text-sm py-2">Back to Login</button>
        </div>
    </div>
    <!-- Rest of body HTML unchanged... (portal-member, modals, etc.) – paste your full body from the message above here to avoid truncation -->
    <div id="toast-box" class="fixed top-6 left-1/2 transform -translate-x-1/2 z-[200] flex flex-col gap-3 w-full max-w-sm px-4 pointer-events-none"></div>
    <!-- ... (include all the <div id="portal-member">, modals, admin portal from your message – it's too long to repeat, but ensure it's there) ... -->
    <script>
      if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
          navigator.serviceWorker.register('/sw.js').catch(() => {}); // Ignore SW errors for demo
        });
      }
    </script>
    <script>
        // Full Demo App Script (complete – no backend needed; falls back to local data)
        const API_BASE = '/api'; // For Vercel; on GitHub Pages, fetches fail but fallback works
        let userToken = localStorage.getItem('token') || '';
        const App = {
            data: { // Demo data
                user: 'Felix',
                role: null,
                news: [{ text: 'AGM Scheduled for Dec 20', signedBy: 'Chairperson' }],
                polls: [{ id: 1, q: 'End of Year Party Venue?', opts: ['Naivasha', 'Mombasa', 'Eldoret'], votes: [2, 5, 1], voters: [], active: true }],
                approvedReports: [{ text: 'Q4 Financial Summary', signedBy: 'Treasurer' }],
                welfare: [{ Type: 'Medical', Amount: 5000, Member: 'Felix', Status: 'Paid', Date: 'Dec 1' }],
                chairQueue: [],
                transactions: [{ Title: 'Monthly Contribution', Date: 'Dec 01', Amount: 5000, Type: 'in', Member: 'Felix' }],
                logs: [{ Action: 'Login', By: 'Felix', Details: 'Successful', Timestamp: 'Dec 13' }],
                members: [{name: 'Felix', email: 'felix@example.com', pin: '1234'}, {name: 'John', email: 'john@example.com', pin: '0000'}],
                signatures: { Secretary: 'Current Secretary', Treasurer: 'Current Treasurer', Chairperson: 'Current Chairperson', SupervisoryCommittee: 'Current Sup. Comm.', CommitteeMember: 'Current Comm. Member' },
                notifications: [{ Message: 'New poll active', Read: false }],
                loans: [{ Amount: 10000, Purpose: 'Business', Member: 'Felix', Status: 'Pending', Date: 'Dec 10' }]
            },
            // Core Functions (Demo – no API calls)
            memberLogin() {
                const pin = document.getElementById('member-pin').value;
                const demoPin = '1234';
                if (pin === demoPin) {
                    App.data.user = 'Felix';
                    localStorage.setItem('token', 'demo-token');
                    userToken = 'demo-token';
                    document.getElementById('screen-auth').classList.add('opacity-0', 'pointer-events-none');
                    setTimeout(() => document.getElementById('screen-auth').style.display = 'none', 500);
                    document.getElementById('portal-member').classList.remove('hidden');
                    document.getElementById('welcome-user').innerText = App.data.user;
                    App.renderAll();
                    App.renderNotifications();
                    App.toast('Welcome back, Felix!', 'success');
                } else {
                    App.toast('Invalid PIN', 'error');
                }
            },
            showRegister() {
                document.getElementById('screen-auth').classList.add('hidden');
                document.getElementById('screen-register').classList.remove('hidden');
            },
            showLogin() {
                document.getElementById('screen-register').classList.add('hidden');
                document.getElementById('screen-auth').classList.remove('hidden');
            },
            registerMember() {
                const name = document.getElementById('reg-name').value;
                const email = document.getElementById('reg-email').value;
                const pin = document.getElementById('reg-pin').value;
                if (name && email && pin) {
                    App.data.members.push({ name, email, pin });
                    App.toast('Registered! Use your PIN to login.', 'success');
                    App.showLogin();
                } else {
                    App.toast('Fill all fields', 'error');
                }
            },
            nav(section) {
                // Hide all sections
                document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
                // Show selected
                document.getElementById(`view-${section}`).classList.remove('hidden');
                // Update nav active
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                document.getElementById(`nav-${section}`).classList.add('active');
                // Update header
                document.getElementById('header-title').innerText = section.charAt(0).toUpperCase() + section.slice(1);
                // Render data
                if (section === 'dashboard') App.renderDashboard();
                else if (section === 'finance') App.renderFinance();
                else if (section === 'welfare') App.renderWelfare();
                else if (section === 'vote') App.renderPolls();
                else if (section === 'profile') App.renderProfile();
            },
            renderAll() {
                App.renderNews();
                App.renderApprovedReports();
                App.renderFinance();
                App.renderWelfare();
                App.renderPolls();
                App.renderProfile();
                App.renderDashboard();
            },
            renderDashboard() {
                document.getElementById('dash-poll-count').innerText = App.data.polls.filter(p => p.active).length;
                // Liquidity demo
            },
            renderNews() {
                const el = document.getElementById('member-news-feed');
                el.innerHTML = App.data.news.map(n => `<div class="bg-white/5 p-4 rounded-xl border border-white/5"><p class="text-sm text-white">${n.text}</p><p class="text-[10px] text-slate-500 mt-2 text-right">Signed: ${n.signedBy}</p></div>`).join('') || '<p class="text-slate-500 text-sm italic">No official news released.</p>';
            },
            renderApprovedReports() {
                const el = document.getElementById('approved-reports');
                el.innerHTML = App.data.approvedReports.map(r => `<div class="bg-white/5 p-4 rounded-xl border border-white/5"><p class="text-sm text-white">${r.text}</p><p class="text-[10px] text-slate-500 mt-2">Signed: ${r.signedBy}</p></div>`).join('') || '<p class="text-slate-500 text-sm italic">No reports.</p>';
            },
            renderFinance() {
                const el = document.getElementById('finance-list');
                el.innerHTML = App.data.transactions.map(t => `<div class="p-4"><div class="flex justify-between"><span class="text-white">${t.Title}</span><span class="text-emerald-400">KES ${t.Amount}</span></div><p class="text-xs text-slate-500">${t.Date}</p></div>`).join('');
            },
            renderWelfare() {
                const list = document.getElementById('welfare-list');
                list.innerHTML = App.data.welfare.map(w => {
                    const s1 = w.Status === 'Sec' ? 'text-blue-400 animate-pulse' : 'text-emerald-500';
                    const s2 = w.Status === 'Treas' ? 'text-blue-400 animate-pulse' : (w.Status === 'Chair' || w.Status === 'Paid' ? 'text-emerald-500' : 'text-slate-700');
                    const s3 = w.Status === 'Chair' ? 'text-blue-400 animate-pulse' : (w.Status === 'Paid' ? 'text-emerald-500' : 'text-slate-700');
                    return `
                        <div class="bg-dark-900 p-4 rounded-xl border border-white/5">
                            <div class="flex justify-between mb-3"><span class="font-bold text-white text-sm">${w.Type}</span><span class="font-mono text-pink-400 text-sm">KES ${w.Amount}</span></div>
                            <div class="flex items-center justify-between text-xs px-2">
                                <div class="text-center ${s1}"><i class="fa-solid fa-file-pen"></i><p class="scale-75">Recorded</p></div>
                                <div class="h-0.5 w-8 bg-white/10"></div>
                                <div class="text-center ${s2}"><i class="fa-solid fa-coins"></i><p class="scale-75">Funded</p></div>
                                <div class="h-0.5 w-8 bg-white/10"></div>
                                <div class="text-center ${s3}"><i class="fa-solid fa-stamp"></i><p class="scale-75">Released</p></div>
                            </div>
                            <p class="text-xs text-slate-500 mt-2 text-center">Claimed by: ${w.Member} on ${w.Date}</p>
                        </div>`;
                }).join('') || '<p class="text-slate-500 text-sm italic">No claims history.</p>';
            },
            renderPolls() {
                const container = document.getElementById('polls-container');
                container.innerHTML = App.data.polls.filter(p => p.active).map(p => `
                    <div class="glass p-6 rounded-2xl">
                        <h3 class="text-white font-bold mb-4">${p.q}</h3>
                        <div class="space-y-2">
                            ${p.opts.map((opt, i) => `<button onclick="App.castVote(1, ${i})" class="w-full text-left p-3 bg-white/5 rounded-lg hover:bg-white/10">${opt} (${p.votes[i] || 0} votes)</button>`).join('')}
                        </div>
                    </div>
                `).join('') || '<p class="text-slate-500">No active polls.</p>';
                if (App.data.polls.some(p => !p.active)) document.getElementById('download-btn').classList.remove('hidden');
            },
            castVote(pollId, optIndex) {
                App.data.polls[pollId - 1].votes[optIndex]++;
                App.data.polls[pollId - 1].voters.push(App.data.user);
                App.toast('Vote cast!', 'success');
                App.renderPolls();
            },
            renderProfile() {
                const user = App.data.members.find(m => m.name === App.data.user);
                document.getElementById('profile-name').value = user ? user.name : App.data.user;
                document.getElementById('profile-email').value = user ? user.email : 'demo@example.com';
            },
            changePin() {
                const newPin = document.getElementById('new-pin').value;
                if (newPin.length === 4) {
                    const user = App.data.members.find(m => m.name === App.data.user);
                    if (user) user.pin = newPin;
                    App.toast('PIN updated!', 'success');
                    document.getElementById('new-pin').value = '';
                }
            },
            openWelfareModal() {
                document.getElementById('modal-welfare').classList.remove('hidden');
            },
            submitWelfare() {
                const type = document.getElementById('welfare-type').value;
                const amt = document.getElementById('welfare-amount').value;
                if (amt) {
                    App.data.welfare.push({ Type: type, Amount: amt, Member: App.data.user, Status: 'Sec', Date: new Date().toLocaleDateString() });
                    document.getElementById('modal-welfare').classList.add('hidden');
                    App.toast('Claim submitted!', 'success');
                    App.renderWelfare();
                }
            },
            openLoanModal() {
                document.getElementById('modal-loan').classList.remove('hidden');
            },
            submitLoan() {
                const amt = document.getElementById('loan-amount').value;
                const purpose = document.getElementById('loan-purpose').value;
                if (amt && purpose) {
                    App.data.loans.push({ Amount: amt, Purpose: purpose, Member: App.data.user, Status: 'Pending', Date: new Date().toLocaleDateString() });
                    document.getElementById('modal-loan').classList.add('hidden');
                    App.toast('Loan applied!', 'success');
                }
            },
            uploadSlip() {
                App.toast('Upload feature demo – payment recorded!', 'success');
                App.data.transactions.push({ Title: 'Deposit Slip', Date: new Date().toLocaleDateString(), Amount: 5000, Type: 'in', Member: App.data.user });
                App.renderFinance();
            },
            toggleNotifications() {
                const panel = document.getElementById('notifications-panel');
                panel.classList.toggle('hidden');
            },
            renderNotifications() {
                const badge = document.getElementById('notif-badge');
                const count = App.data.notifications.filter(n => !n.Read).length;
                badge.innerText = count;
                badge.classList.toggle('hidden', count === 0);
                const list = document.getElementById('notif-list');
                list.innerHTML = App.data.notifications.map((n, i) => `<div class="p-2 bg-white/5 rounded cursor-pointer" onclick="App.markRead(${i})">${n.Message} <span class="text-xs text-slate-400">${n.Read ? 'Read' : 'New'}</span></div>`).join('');
            },
            markRead(index) {
                App.data.notifications[index].Read = true;
                App.renderNotifications();
            },
            toast(message, type = 'info') {
                const box = document.getElementById('toast-box');
                const toast = document.createElement('div');
                toast.className = `glass p-4 rounded-xl text-white toast ${type === 'success' ? 'border-l-brand-500' : type === 'error' ? 'border-l-red-500' : ''}`;
                toast.innerHTML = `<i class="fa-solid fa-${type === 'success' ? 'check' : type === 'error' ? 'x' : 'info'}-circle mr-2"></i>${message}`;
                box.appendChild(toast);
                setTimeout(() => toast.remove(), 3000);
            },
            // Admin Functions (Demo)
            switchContext(context) {
                if (context === 'admin') {
                    document.getElementById('portal-member').classList.add('hidden');
                    document.getElementById('portal-admin').classList.remove('hidden', 'opacity-0', 'scale-95');
                    setTimeout(() => document.getElementById('portal-admin').classList.remove('opacity-0', 'scale-95'), 100);
                }
            },
            adminLogout() {
                document.getElementById('portal-admin').classList.add('hidden');
                document.getElementById('portal-member').classList.remove('hidden');
            },
            adminLogin(role) {
                App.data.role = role;
                document.getElementById('admin-screen-login').classList.add('hidden');
                document.getElementById(`view-admin-${role.replace(/([A-Z])/g, c => `-${c.toLowerCase()}`)}`).classList.remove('hidden');
                document.getElementById('admin-badge').innerText = 'Active';
                document.getElementById('admin-badge').className = 'text-[10px] bg-green-500/20 px-2 py-0.5 rounded text-green-400 ml-2 uppercase';
                App.renderAdmin(role);
            },
            renderAdmin(role) {
                // Demo render for each role – e.g., for Secretary
                if (role === 'Secretary') {
                    document.getElementById('sec-welfare-queue').innerHTML = '<p class="text-slate-400">No pending claims.</p>';
                    document.getElementById('members-list').innerHTML = App.data.members.map(m => `<p class="text-white">${m.name} - ${m.email}</p>`).join('');
                }
                // Add similar for other roles...
            },
            createPoll() {
                const q = document.getElementById('poll-question').value;
                const opts = document.getElementById('poll-opts').value.split(',').map(o => o.trim());
                if (q && opts.length > 1) {
                    App.data.polls.push({ id: App.data.polls.length + 1, q, opts, votes: new Array(opts.length).fill(0), voters: [], active: true });
                    App.toast('Poll created!', 'success');
                    document.getElementById('poll-question').value = '';
                    document.getElementById('poll-opts').value = '';
                }
            },
            // Add more functions as needed (submitNews, addMember, etc.) – demo versions
            addMember() {
                const name = document.getElementById('new-member-name').value;
                const email = document.getElementById('new-member-email').value;
                if (name && email) {
                    App.data.members.push({ name, email, pin: '0000' });
                    App.toast('Member added!', 'success');
                    document.getElementById('new-member-name').value = '';
                    document.getElementById('new-member-email').value = '';
                }
            },
            // ... (expand for handover, etc. – keep demo simple)
            downloadResults() {
                App.toast('Results downloaded (demo)', 'success');
            },
            downloadAuditReport() {
                App.toast('Audit report downloaded (demo)', 'success');
            }
        };
        // Init
        window.onload = () => {
            setTimeout(() => {
                document.getElementById('splash-screen').classList.add('opacity-0', 'pointer-events-none');
                setTimeout(() => document.getElementById('splash-screen').style.display = 'none', 700);
            }, 1500);
        };
    </script>
</body>
</html>
